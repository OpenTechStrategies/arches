## Arches 8.1.0 Release Notes

### Major enhancements

### Performance improvements

### Additional highlights

- Adds new parameters to external authentication to support the private_key_jwt authenication method.  [#12473](https://github.com/archesproject/arches/issues/12473)
-   Log exceptions in background tasks [#12214](https://github.com/archesproject/arches/pull/12214)
-   Add dependabot configuration for NPM packages [#12026](https://github.com/archesproject/arches/pull/12026)
-   Make `UserProfile.{viewable|editable|deletable}_nodegroups` a `@cached_property` [#12363](https://github.com/archesproject/arches/pull/12363)
-   Allow for users to be loaded from an arches package [#12419](https://github.com/archesproject/arches/issues/12419)
-   Update ESLint config to allow prepending underscores to unused args and variables [#12338](https://github.com/archesproject/arches/issues/12338)
-   Add global function support for running arches functions regardless of configuration [#12465](https://github.com/archesproject/arches/pull/12465)
-   Add capability to import the file with the metadata with the bulk data importer. Also the metadata is added to index so that the resource can be searched. [#12370](https://github.com/archesproject/arches/pull/12370)
-   Fix issue with the null value in the file-list node for the excel importers by not creating the staged value [#12430](https://github.com/archesproject/arches/pull/12430)
-   Fix `generate_urls_json` function to properly namespace applications [#12449](https://github.com/archesproject/arches/issues/12449)

```
Python:
    Upgraded:

    Added:

    Removed:


JavaScript:
    Upgraded:

    Added:

    Removed:
```

### New features

- Support for the private_key_jwt token endpoint authentication method can be activated by adding    
    ```
    "token_endpoint_auth_method": "private_key_jwt",
    "public_certificate": "your_cert.pem",
    "private_key": "your_key_file.key",
    "private_key_password": b"password"
    ```
to EXTERNAL_OAUTH_CONFIGURATION in settings.py.  You may also need to add "jwt_audience" depending on what your provider requests in the audience field of the JWT arches creates.  You can also provide "public_key" in lieu of a public_certificate - depending on your identity provider.  Your certificate and key need to exist either within your project directory or need to be in a place reachable by certifi.  Also strongly consider storing your password securely in a password vault or external source rather than in your settings.py file directly.  This configuration has only been tested against a Microsoft Azure based application provider and an Auth0 provider, but should work anywhere an private_key_jwt is supported.
SESSION_COOKIE_SAMESITE will also need to be set to "Lax"

### Breaking changes

-   Recent versions of Arches made a "best" effort to ensure that field values injected by Django model `save()` methods were not evaded by the use of `update_or_create()` in recent versions of Django. Such uses of `update_or_create()` now raise `FutureWarning`. If you find this warning in your logs or tests, assess whether you need the injected values and opt-in by providing such field names in `defaults`:

    ```py
    TileModel.objects.update_or_create(
        pk=provisional_tile.pk,
        nodegroup_id=provisional_tile.nodegroup_id,
        # presence of "sortorder" in defaults signifies that the
        # sortorder re-calculation in TileModel.save() is wanted.
        defaults={"sortorder": random.randint()},
    )
    ```

-   `arches/app/src/arches/utils/generateArchesURL()` now requires a namespaced `urlName`. Valid `urlName` values are the keys in `$my_project/frontend_configuration/urls.json`. In this version of Arches these keys are now namespaced, and all callsites of `generateArchesURL()` must be updated accordingly.

    ```.json
    // before
    {
        "export_branch": [
            { "url": "/graph/{graphid}/export_branch", "params": ["graphid"] }
        ]
    }

    // after
    {
        "arches:export_branch": [
            { "url": "/graph/{graphid}/export_branch", "params": ["graphid"] }
        ]
    }
    ```

### Upgrading Arches

### Upgrading an Arches project

1. Apply automatic updates:

    ```
    python manage.py updateproject
    ```

1. Update `generateArchesURL()` callsites to include application namespaces:

    ```js
    // before
    generateArchesURL("export_branch", { graphid: selectedGraphId });

    // after
    generateArchesURL("arches:export_branch", { graphid: selectedGraphId });
    ```
